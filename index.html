<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distory Go - V57 IRONCLAD</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-dark: #02050e;
            --panel-bg: rgba(10, 15, 30, 0.98);
            --border-color: #1e293b;
            --highlight-blue: #3b82f6;
            --highlight-purple: #8b5cf6;
            --hp-red: #be123c;
            --gold: #fbbf24;
        }

        body {
            background-color: var(--bg-dark);
            color: #f8fafc;
            font-family: 'Rajdhani', sans-serif;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- ANIMATIONS --- */
        @keyframes hero-float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes scan-laser { 0% { top: -10px; opacity: 0; } 10% { opacity: 1; } 100% { top: 100%; opacity: 0; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        .anim-float { animation: hero-float 3s ease-in-out infinite; }
        .anim-shake { animation: shake 0.2s ease-in-out; }
        
        .laser-line {
            position: absolute; left: 0; width: 100%; height: 2px;
            background: var(--highlight-blue); box-shadow: 0 0 15px var(--highlight-blue);
            z-index: 50; pointer-events: none; opacity: 0;
        }
        .scanning { animation: scan-laser 0.5s linear forwards; }

        /* --- LAYOUT --- */
        .layout { display: grid; grid-template-columns: 350px 1fr 320px; gap: 12px; height: 100vh; padding: 12px; transition: filter 0.3s; }
        .layout.blur { filter: blur(10px); pointer-events: none; }

        .panel {
            background: var(--panel-bg); border: 1px solid var(--border-color); border-radius: 8px;
            display: flex; flex-direction: column; overflow: hidden; position: relative;
        }

        .header {
            padding: 10px 15px; background: rgba(255,255,255,0.03); border-bottom: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            font-weight: 700; color: var(--highlight-blue); text-transform: uppercase; font-size: 14px;
        }

        /* --- GAUCHE --- */
        .bio-zone { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .hero-avatar { font-size: 130px; filter: drop-shadow(0 0 20px rgba(59,130,246,0.4)); }
        
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 0 20px 20px; }
        .stat-box { background: rgba(255,255,255,0.03); border: 1px solid var(--border-color); padding: 8px; text-align: center; border-radius: 4px; }
        .stat-val { font-size: 24px; font-weight: 800; color: #e2e8f0; }
        .stat-lbl { font-size: 10px; color: #64748b; font-weight: 700; text-transform: uppercase; }

        .hp-zone { padding: 0 20px 10px; }
        .hp-bar { width: 100%; height: 6px; background: black; border: 1px solid #334155; border-radius: 3px; overflow: hidden; }
        .hp-fill { height: 100%; background: var(--hp-red); width: 100%; transition: width 0.3s; }

        .equip-zone { padding: 15px; border-top: 1px solid var(--border-color); display: flex; gap: 10px; background: rgba(0,0,0,0.2); }

        /* --- CENTRE --- */
        .viewport { flex-grow: 1; position: relative; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .mission-title { font-size: 70px; font-weight: 900; line-height: 1; text-transform: uppercase; }
        .mission-sub { font-size: 12px; color: var(--highlight-blue); border: 1px solid var(--highlight-blue); padding: 2px 15px; border-radius: 20px; margin-top: 10px; }

        .enemy-box { text-align: center; display: none; }
        .enemy-box.active { display: block; }
        .enemy-sprite { font-size: 140px; filter: drop-shadow(0 0 30px rgba(220, 38, 38, 0.5)); }

        .actions { height: 200px; border-top: 1px solid var(--border-color); padding: 15px; display: grid; grid-template-columns: 1fr 180px; gap: 15px; background: rgba(0,0,0,0.2); }
        
        .inv-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; align-content: start; }
        .slot { 
            aspect-ratio: 1; background: rgba(255,255,255,0.03); border: 1px solid var(--border-color); 
            border-radius: 4px; display: flex; align-items: center; justify-content: center; 
            font-size: 22px; cursor: pointer; transition: 0.1s; 
        }
        .slot:hover { border-color: var(--highlight-blue); background: rgba(59,130,246,0.1); }
        .slot.equipped { border-color: var(--gold); box-shadow: inset 0 0 10px rgba(251, 191, 36, 0.2); }

        .btn-main { 
            width: 100%; height: 60px; background: linear-gradient(180deg, #3b82f6, #1d4ed8); 
            border: 1px solid #60a5fa; border-radius: 6px; color: white; font-size: 22px; 
            font-weight: 800; text-transform: uppercase; cursor: pointer; transition: 0.1s;
        }
        .btn-main:active { transform: translateY(2px); filter: brightness(0.9); }
        .btn-main:disabled { filter: grayscale(1); opacity: 0.5; cursor: not-allowed; }

        /* --- DROITE --- */
        .logs { flex-grow: 1; padding: 10px; overflow-y: auto; font-family: monospace; font-size: 12px; color: #94a3b8; display: flex; flex-direction: column-reverse; }
        .log-line { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 2px; }

        /* --- MODALS --- */
        .modal-full { position: fixed; inset: 0; background: var(--bg-dark); z-index: 5000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .avatar-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
        .avatar-opt { font-size: 60px; padding: 20px; background: rgba(255,255,255,0.05); border: 2px solid var(--border-color); border-radius: 12px; cursor: pointer; transition: 0.2s; }
        .avatar-opt:hover { border-color: var(--highlight-blue); transform: scale(1.1); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="laser" class="laser-line"></div>

    <div id="boot-screen" class="modal-full">
        <h1 class="text-4xl font-black text-white mb-10 tracking-widest">S√âLECTION DU PILOTE</h1>
        <div class="avatar-grid">
            <button class="avatar-opt" onclick="Game.start('üêô')">üêô</button>
            <button class="avatar-opt" onclick="Game.start('üêπ')">üêπ</button>
            <button class="avatar-opt" onclick="Game.start('ü¶ä')">ü¶ä</button>
            <button class="avatar-opt" onclick="Game.start('ü¶å')">ü¶å</button>
            <button class="avatar-opt" onclick="Game.start('üêï')">üêï</button>
            <button class="avatar-opt" onclick="Game.start('üê±')">üê±</button>
        </div>
        <button onclick="Game.resetData()" class="text-xs text-red-500 uppercase border-b border-red-900 hover:text-white">R√©initialiser les donn√©es</button>
    </div>

    <div id="game-ui" class="layout blur">
        <div class="panel">
            <div class="header"><span>PILOTE</span> <span id="ui-name" class="text-blue-400">...</span></div>
            <div class="bio-zone">
                <div class="absolute top-2 right-4 text-right">
                    <div class="text-[10px] text-gray-500 font-bold uppercase">Niveau</div>
                    <div id="ui-lvl" class="text-2xl font-bold">1</div>
                </div>
                <div id="ui-avatar" class="hero-avatar anim-float">?</div>
            </div>
            <div class="hp-zone">
                <div class="flex justify-between text-[10px] font-bold text-gray-400 mb-1 uppercase"><span>Int√©grit√©</span> <span id="ui-hp-txt">100/100</span></div>
                <div class="hp-bar"><div id="ui-hp-fill" class="hp-fill"></div></div>
            </div>
            <div class="stat-grid">
                <div class="stat-box"><div class="stat-lbl">PUISSANCE</div><div id="ui-atk" class="stat-val text-blue-400">10</div></div>
                <div class="stat-box"><div class="stat-lbl">BLINDAGE</div><div id="ui-def" class="stat-val text-blue-400">0</div></div>
            </div>
            <div class="equip-zone">
                <div id="slot-w" class="slot" style="flex:1">‚öîÔ∏è</div>
                <div id="slot-h" class="slot" style="flex:1">üõ°Ô∏è</div>
                <div id="slot-p" class="slot" style="flex:1">üêæ</div>
            </div>
        </div>

        <div class="panel">
            <div class="header">
                <span>ZONE <span id="ui-zone">1-1</span></span>
                <div class="flex gap-4"><span class="text-gold">ü™ô <span id="ui-gold">0</span></span><span class="text-purple-400">‚ú® <span id="ui-gems">0</span></span></div>
            </div>
            
            <div class="viewport">
                <div id="view-mission" class="text-center">
                    <div class="mission-title">MISSION</div>
                    <div class="mission-sub">SECTEUR ACTIF</div>
                </div>
                <div id="view-combat" class="enemy-box">
                    <div id="ui-enemy-icon" class="enemy-sprite">üëæ</div>
                    <div class="mt-4 text-red-400 font-bold uppercase tracking-widest text-sm bg-red-900/30 px-4 py-1 rounded">Cible Hostile</div>
                </div>
            </div>

            <div class="actions">
                <div class="flex flex-col">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[10px] font-bold text-gray-500 uppercase">SOUTE</span>
                        <button onclick="Game.chest()" class="bg-purple-600 hover:bg-purple-500 text-white text-[10px] px-2 py-1 rounded font-bold uppercase">COFFRE (5‚ú®)</button>
                    </div>
                    <div id="inv-grid" class="inv-grid"></div>
                </div>
                <div class="flex flex-col justify-end gap-2">
                    <button id="btn-action" onclick="Game.action()" class="btn-main">LANCER</button>
                    <div class="flex justify-between">
                        <button id="btn-auto" onclick="Game.toggleAuto()" class="text-[10px] border border-blue-900 px-2 py-1 rounded uppercase text-gray-400 hover:text-white">AUTO: OFF</button>
                        <button id="btn-speed" onclick="Game.toggleSpeed()" class="text-[10px] border border-blue-900 px-2 py-1 rounded uppercase text-gray-400 hover:text-white">VIT: x1</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="header"><span>JOURNAL</span> <button onclick="UI.toggleHub()" class="text-xs text-gray-500 hover:text-white">‚öôÔ∏è</button></div>
            <div id="logs" class="logs">
                <div class="log-line">> Syst√®me en attente.</div>
            </div>
            <div class="flex border-t border-gray-800">
                <button class="flex-1 p-3 text-xs font-bold text-white bg-white/5 border-b-2 border-blue-500">AVENTURE</button>
                <button onclick="UI.toggleHub()" class="flex-1 p-3 text-xs font-bold text-gray-500 hover:text-white">BASE</button>
            </div>
        </div>
    </div>

    <div id="hub-view" class="fixed inset-0 bg-[#02050e] z-40 hidden flex-col items-center justify-center">
        <h2 class="text-4xl font-bold text-white mb-10 uppercase italic">Maintenance Base</h2>
        <div class="grid grid-cols-1 gap-6 w-80">
            <div onclick="Game.upgrade('hp')" class="bg-white/5 border border-blue-900 p-4 rounded hover:border-blue-500 cursor-pointer flex justify-between">
                <div><div class="text-xs text-gray-500 font-bold">VITALIT√â</div><div class="text-xl font-bold">+20 PV</div></div>
                <div id="cost-hp" class="text-gold font-bold">100</div>
            </div>
            <div onclick="Game.upgrade('atk')" class="bg-white/5 border-blue-900 border p-4 rounded hover:border-blue-500 cursor-pointer flex justify-between">
                <div><div class="text-xs text-gray-500 font-bold">FORCE</div><div class="text-xl font-bold">+5 ATK</div></div>
                <div id="cost-atk" class="text-gold font-bold">100</div>
            </div>
            <div onclick="Game.upgrade('def')" class="bg-white/5 border-blue-900 border p-4 rounded hover:border-blue-500 cursor-pointer flex justify-between">
                <div><div class="text-xs text-gray-500 font-bold">D√âFENSE</div><div class="text-xl font-bold">+2 DEF</div></div>
                <div id="cost-def" class="text-gold font-bold">100</div>
            </div>
        </div>
        <button onclick="UI.toggleHub()" class="mt-12 text-blue-500 font-bold uppercase hover:text-white">Retour</button>
    </div>

    <script>
        // DONN√âES
        const DATA = {
            enemies: [{n:"Drone", i:"üõ∏", h:50, a:5}, {n:"Xeno", i:"üëæ", h:80, a:8}],
            items: [
                {n:"Lame", i:"‚öîÔ∏è", t:"weapon", s:10}, 
                {n:"Casque", i:"üõ°Ô∏è", t:"head", s:20}, 
                {n:"Bot", i:"ü§ñ", t:"pet", s:5}
            ]
        };

        // VARIABLES DE JEU
        let P = { char: null, gold: 0, gems: 20, lvl: 1, stats: {hp:0, atk:0, def:0}, inv:[], eq: {weapon:null, head:null, pet:null} };
        let R = { active: false, day: 0, hp: 100, max: 100, atk: 10, def: 0, auto: false, speed: 1 };
        let Combat = { on: false, ehp: 0, emax: 0, eatk: 0 };
        let autoInterval = null;

        // MOTEUR
        const Game = {
            init: () => {
                let s = localStorage.getItem('distory_v57');
                if(s) {
                    P = JSON.parse(s);
                    if(P.char) {
                        document.getElementById('boot-screen').classList.add('hidden');
                        document.getElementById('game-ui').classList.remove('blur');
                        UI.refresh();
                    }
                }
            },
            start: (char) => {
                P.char = char;
                Game.save();
                document.getElementById('boot-screen').classList.add('hidden');
                document.getElementById('game-ui').classList.remove('blur');
                UI.refresh();
            },
            resetData: () => {
                localStorage.clear();
                location.reload();
            },
            save: () => localStorage.setItem('distory_v57', JSON.stringify(P)),

            // ACTION PRINCIPALE
            action: () => {
                if(Combat.on) return; // Pas d'action si combat en cours
                
                // Animation Scan
                const laser = document.getElementById('laser');
                laser.classList.remove('scanning');
                void laser.offsetWidth; // Reset anim
                laser.classList.add('scanning');

                // Logique
                if(!R.active) { R.active = true; R.day = 1; UI.log("Mission initialis√©e."); }
                else R.day++;

                Game.calcStats();
                
                // 20% Chance combat
                if(R.day % 5 === 0) {
                    Game.startCombat();
                } else {
                    // Loot
                    P.gold += 20;
                    UI.log(`> Ressources trouv√©es (+20 Or)`);
                    UI.refresh();
                }
            },

            // COMBAT
            startCombat: () => {
                Combat.on = true;
                let en = DATA.enemies[Math.floor(Math.random()*DATA.enemies.length)];
                let mult = 1 + (R.day * 0.1);
                Combat.emax = Math.floor(en.h * mult);
                Combat.ehp = Combat.emax;
                Combat.eatk = Math.floor(en.a * mult);
                
                document.getElementById('view-mission').classList.add('hidden');
                document.getElementById('view-combat').classList.add('active');
                document.getElementById('ui-enemy-icon').innerText = en.i;
                document.getElementById('btn-action').disabled = true;
                document.getElementById('btn-action').innerText = "COMBAT...";

                UI.log(`! ALERTE : ${en.n} d√©tect√© !`);
                setTimeout(Game.turn, 800/R.speed);
            },

            turn: () => {
                if(!Combat.on) return;

                // Joueur tape
                Combat.ehp -= R.atk;
                document.getElementById('ui-enemy-icon').classList.add('anim-shake');
                setTimeout(()=>document.getElementById('ui-enemy-icon').classList.remove('anim-shake'), 200);

                if(Combat.ehp <= 0) {
                    Combat.on = false;
                    P.gold += 50;
                    UI.log("> Cible √©limin√©e (+50 Or).");
                    Game.endCombat();
                    return;
                }

                // Ennemi tape
                setTimeout(() => {
                    let dmg = Math.max(1, Combat.eatk - R.def);
                    R.hp -= dmg;
                    UI.refresh();
                    
                    if(R.hp <= 0) {
                        Combat.on = false;
                        R.active = false;
                        R.auto = false;
                        clearInterval(autoInterval);
                        UI.log("!!! MISSION √âCHOU√âE !!!");
                        Game.endCombat();
                    } else {
                        setTimeout(Game.turn, 800/R.speed);
                    }
                }, 400/R.speed);
            },

            endCombat: () => {
                document.getElementById('view-mission').classList.remove('hidden');
                document.getElementById('view-combat').classList.remove('active');
                document.getElementById('btn-action').disabled = false;
                document.getElementById('btn-action').innerText = "LANCER";
                UI.refresh();
                Game.save();
            },

            // STATS & INVENTAIRE
            calcStats: () => {
                R.max = 100 + (P.stats.hp * 20);
                R.atk = 10 + (P.stats.atk * 5);
                R.def = P.stats.def * 2;
                if(P.eq.weapon) R.atk += P.eq.weapon.s;
                if(P.eq.head) R.max += P.eq.head.s;
                if(P.eq.pet) R.atk += P.eq.pet.s;
                
                // Heal si hors combat et max augment√©
                if(!Combat.on) R.hp = Math.min(R.hp + 5, R.max);
            },

            chest: () => {
                if(P.gems >= 5) {
                    P.gems -= 5;
                    let item = {...DATA.items[Math.floor(Math.random()*DATA.items.length)], uid: Date.now()};
                    P.inv.push(item);
                    Game.checkFusion();
                    UI.refresh();
                    Game.save();
                    UI.log(`> Coffre: ${item.n} obtenu.`);
                } else UI.log("> Pas assez de gemmes.");
            },

            checkFusion: () => {
                let counts = {};
                P.inv.forEach(i => counts[i.n] = (counts[i.n] || 0) + 1);
                for (let n in counts) {
                    if (counts[n] >= 3) {
                        let base = P.inv.find(x => x.n === n);
                        // Retirer 3
                        let removed = 0;
                        P.inv = P.inv.filter(x => {
                            if(x.n === n && removed < 3) { removed++; return false; }
                            return true;
                        });
                        // Ajouter upgrade
                        P.inv.push({...base, s: Math.floor(base.s * 2.2), n: base.n + "+", uid: Date.now()});
                        UI.log(`*** FUSION: ${base.n} ***`);
                        Game.checkFusion(); // Recursif
                        return;
                    }
                }
            },

            equip: (uid) => {
                let idx = P.inv.findIndex(x => x.uid === uid);
                if(idx > -1) {
                    let item = P.inv[idx];
                    if(P.eq[item.t]) P.inv.push(P.eq[item.t]); // D√©s√©quiper l'ancien
                    P.eq[item.t] = item;
                    P.inv.splice(idx, 1);
                    Game.calcStats();
                    UI.refresh();
                    Game.save();
                }
            },

            upgrade: (s) => {
                let cost = 100 + (P.stats[s] * 50);
                if(P.gold >= cost) {
                    P.gold -= cost;
                    P.stats[s]++;
                    Game.calcStats();
                    UI.refresh();
                    Game.save();
                }
            },

            // CONTROLES
            toggleAuto: () => {
                R.auto = !R.auto;
                document.getElementById('btn-auto').innerText = R.auto ? "AUTO: ON" : "AUTO: OFF";
                document.getElementById('btn-auto').style.color = R.auto ? "#3b82f6" : "#9ca3af";
                
                if(R.auto) {
                    if(autoInterval) clearInterval(autoInterval);
                    autoInterval = setInterval(() => {
                        if(!Combat.on && R.active) Game.action();
                    }, 1200/R.speed);
                } else {
                    clearInterval(autoInterval);
                }
            },
            toggleSpeed: () => {
                R.speed = R.speed === 1 ? 2 : 1;
                document.getElementById('btn-speed').innerText = `VIT: x${R.speed}`;
                // Restart interval si auto actif pour appliquer vitesse
                if(R.auto) { Game.toggleAuto(); Game.toggleAuto(); } 
            }
        };

        // VISUEL
        const UI = {
            refresh: () => {
                document.getElementById('ui-gold').innerText = P.gold;
                document.getElementById('ui-gems').innerText = P.gems;
                document.getElementById('ui-avatar').innerText = P.char || "?";
                document.getElementById('ui-zone').innerText = `1-${R.day}`;
                document.getElementById('ui-lvl').innerText = Math.floor(R.day/10)+1;
                
                // Barres
                document.getElementById('ui-hp-txt').innerText = `${Math.floor(R.hp)}/${R.max}`;
                document.getElementById('ui-hp-fill').style.width = (R.hp/R.max*100)+"%";
                document.getElementById('ui-atk').innerText = R.atk;
                document.getElementById('ui-def').innerText = R.def;

                // Inventaire
                let g = document.getElementById('inv-grid');
                g.innerHTML = '';
                P.inv.forEach(i => {
                    let d = document.createElement('div');
                    d.className = 'slot'; d.innerText = i.i;
                    d.onclick = () => Game.equip(i.uid);
                    g.appendChild(d);
                });

                // Equipement
                const setEq = (id, it) => {
                    let el = document.getElementById(id);
                    if(it) { el.innerText = it.i; el.classList.add('equipped'); }
                    else { el.innerText = id==='slot-w'?'‚öîÔ∏è':id==='slot-h'?'üõ°Ô∏è':'üêæ'; el.classList.remove('equipped'); }
                };
                setEq('slot-w', P.eq.weapon);
                setEq('slot-h', P.eq.head);
                setEq('slot-p', P.eq.pet);

                // Hub Costs
                ['hp','atk','def'].forEach(k => {
                    document.getElementById(`cost-${k}`).innerText = (100 + P.stats[k]*50) + " ü™ô";
                });
            },
            log: (msg) => {
                let l = document.getElementById('logs');
                l.innerHTML = `<div class="log-line">> ${msg}</div>` + l.innerHTML;
            },
            toggleHub: () => {
                let h = document.getElementById('hub-view');
                h.classList.toggle('hidden');
                h.classList.toggle('flex'); // Pour centrer avec flexbox
            }
        };

        window.onload = Game.init;
    </script>
</body>
</html>
