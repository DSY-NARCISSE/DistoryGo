<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distory Go - V52 EXACT HUD</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg-deep: #02050e; 
            --panel-bg: rgba(8, 12, 28, 0.95);
            --border-blue: #1c2a4d;
            --active-blue: #3b82f6;
            --text-gray: #64748b;
            --hp-red: #be123c;
        }
        body { 
            background: var(--bg-deep); color: white; font-family: 'Rajdhani', sans-serif; 
            overflow: hidden; height: 100vh; user-select: none;
        }

        /* STRUCTURE GLOBALE */
        .layout { display: grid; grid-template-columns: 320px 1fr 300px; gap: 12px; height: 100vh; padding: 12px; }
        .layout.blur { filter: blur(20px); pointer-events: none; }

        .panel { 
            background: var(--panel-bg); border: 1px solid var(--border-blue); border-radius: 8px; 
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* HEADER PANELS */
        .panel-header { padding: 12px 16px; display: flex; justify-content: space-between; align-items: center; }
        .panel-title { color: #8ea5d9; font-weight: 700; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }

        /* GAUCHE : PILOTE */
        .bio-zone { flex-grow: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; position: relative; }
        .bio-lvl { position: absolute; top: 10px; right: 20px; text-align: center; }
        .bio-lvl span { display: block; font-size: 32px; font-weight: 700; margin-top: -5px; }

        .stat-box { background: rgba(255,255,255,0.03); border: 1px solid var(--border-blue); border-radius: 4px; padding: 10px; width: 100%; text-align: center; }
        .stat-label { font-size: 10px; color: var(--text-gray); text-transform: uppercase; font-weight: 700; }
        .stat-value { font-size: 24px; font-weight: 700; color: #8ea5d9; }

        /* JAUGE INTEGRIT√â */
        .hp-section { width: 100%; padding: 0 20px; margin-bottom: 20px; }
        .hp-header { display: flex; justify-content: space-between; font-size: 11px; font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
        .hp-bar-bg { width: 100%; height: 6px; background: #000; border-radius: 3px; overflow: hidden; border: 1px solid #1e293b; }
        .hp-bar-fill { height: 100%; background: var(--hp-red); transition: width 0.3s; }

        /* CENTRE : MISSION */
        .mission-viewport { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .mission-text { font-size: 72px; font-weight: 700; letter-spacing: -2px; }
        .mission-btn-sub { background: rgba(255,255,255,0.03); border: 1px solid var(--border-blue); padding: 4px 30px; border-radius: 20px; font-size: 14px; color: var(--text-gray); }

        /* STOCKAGE & BOUTONS */
        .storage-zone { height: 180px; border-top: 1px solid var(--border-blue); padding: 12px; display: grid; grid-template-columns: 1fr 180px; gap: 15px; }
        .inv-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; align-content: flex-start; }
        .slot { aspect-ratio: 1; background: rgba(0,0,0,0.3); border: 1px solid var(--border-blue); border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; transition: 0.2s; }
        .slot:hover { border-color: var(--active-blue); }

        .btn-relancer { 
            width: 100%; height: 70px; background: linear-gradient(180deg, #3259ce, #1e3a8a); 
            border-radius: 6px; border: 1px solid #4a74e8; color: white; font-weight: 700; font-size: 24px;
            letter-spacing: 2px; text-transform: uppercase; cursor: pointer;
        }

        /* DROITE : JOURNAL */
        .log-area { flex-grow: 1; padding: 10px 16px; font-size: 12px; color: #8ea5d9; overflow-y: auto; display: flex; flex-direction: column-reverse; }
        .log-entry { margin-bottom: 6px; display: flex; gap: 8px; }
        .tabs { height: 50px; border-top: 1px solid var(--border-blue); display: grid; grid-cols: 2; display: flex; }
        .tab-btn { flex: 1; border: none; background: transparent; color: var(--text-gray); font-weight: 700; font-size: 12px; text-transform: uppercase; cursor: pointer; }
        .tab-btn.active { color: white; border-bottom: 2px solid var(--active-blue); }

        /* FUSION FX */
        .glow-active { border-color: var(--gold) !important; box-shadow: 0 0 10px var(--gold); }
        .rarity-legend { border-color: var(--gold); }

        /* MODALS */
        .modal-full { position: fixed; inset: 0; background: var(--bg-deep); z-index: 50000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .avatar-btn { font-size: 70px; padding: 20px; background: rgba(255,255,255,0.02); border: 1px solid var(--border-blue); border-radius: 12px; cursor: pointer; transition: 0.2s; }
        .avatar-btn:hover { border-color: var(--active-blue); transform: scale(1.1); }
        
        .hidden { display: none !important; }
        #tooltip { position: fixed; pointer-events: none; z-index: 10000; background: #0b0f1a; border: 1px solid var(--active-blue); padding: 10px; border-radius: 4px; font-size: 11px; display: none; }
    </style>
</head>
<body>

    <div id="tooltip"></div>
    <div id="modal-container" class="hidden"></div>

    <div id="boot-screen" class="modal-full">
        <h1 class="text-3xl font-bold mb-10 tracking-widest text-blue-300">S√âLECTIONNEZ VOTRE AVATAR</h1>
        <div class="grid grid-cols-3 gap-6">
            <button class="avatar-btn" onclick="Core.selectSpecies('üêô')">üêô</button>
            <button class="avatar-btn" onclick="Core.selectSpecies('üêπ')">üêπ</button>
            <button class="avatar-btn" onclick="Core.selectSpecies('ü¶ä')">ü¶ä</button>
            <button class="avatar-btn" onclick="Core.selectSpecies('ü¶å')">ü¶å</button>
            <button class="avatar-btn" onclick="Core.selectSpecies('üêï')">üêï</button>
            <button class="avatar-btn" onclick="Core.selectSpecies('üê±')">üê±</button>
        </div>
        <button onclick="Core.hardReset()" class="mt-20 text-[10px] text-gray-500 uppercase hover:text-red-500">R√©initialiser les donn√©es</button>
    </div>

    <div id="game-ui" class="layout blur">
        
        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">PILOTE</span>
                <span id="ui-pseudo" style="color: #3b82f6; font-weight: bold; font-size: 12px;">NARCISSE</span>
            </div>
            <div class="bio-zone">
                <div class="bio-lvl text-gray-500 font-bold text-[10px]">NIVEAU<span id="ui-lvl">1</span></div>
                <div id="ui-avatar-display" style="font-size: 120px; margin-top: 20px;">üêô</div>
            </div>
            <div class="hp-section">
                <div class="hp-header"><span>INT√âGRIT√â</span> <span id="ui-hp-txt">180/180</span></div>
                <div class="hp-bar-bg"><div id="ui-hp-fill" class="hp-bar-fill" style="width:100%"></div></div>
            </div>
            <div class="px-6 pb-8 grid grid-cols-2 gap-4">
                <div class="stat-box"><div class="stat-label">PUISSANCE</div><div id="ui-atk" class="stat-value">140</div></div>
                <div class="stat-box"><div class="stat-label">BLINDAGE</div><div id="ui-def" class="stat-value">20</div></div>
            </div>
            <div class="mt-auto p-4 border-t border-slate-800 grid grid-cols-3 gap-2">
                <div id="slot-weapon" class="slot glow-active">‚öîÔ∏è</div>
                <div id="slot-head" class="slot">üõ°Ô∏è</div>
                <div id="slot-pet" class="slot">üêæ</div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header">
                <span class="panel-title">ZONE <span id="ui-zone">1-1</span></span>
                <div class="flex gap-4">
                    <span class="text-yellow-500 font-bold">ü™ô <span id="ui-gold">1807</span></span>
                    <span class="text-purple-400 font-bold">‚ú® <span id="ui-perls">0</span></span>
                </div>
            </div>
            <div class="mission-viewport">
                <div id="enemy-box" class="hidden text-center">
                    <div id="ui-en-img" style="font-size: 150px;">üëæ</div>
                </div>
                <div id="story-box" class="text-center">
                    <div class="mission-text uppercase">MISSION</div>
                    <div class="mission-btn-sub">Secteur 1</div>
                </div>
            </div>
            <div class="storage-zone">
                <div class="flex flex-col">
                    <div class="flex justify-between items-center mb-2">
                        <span class="stat-label">STOCKAGE</span>
                        <button onclick="Core.chest()" style="background: #9333ea; color: white; font-size: 8px; padding: 2px 8px; border-radius: 2px; font-weight: bold;">OUVRIR COFFRE (5‚ú®)</button>
                    </div>
                    <div id="inv-grid" class="inv-grid"></div>
                </div>
                <div class="flex flex-col justify-end gap-2">
                    <button id="main-btn" onclick="Core.processScanner()" class="btn-relancer">RELANCER</button>
                    <div class="text-[10px] text-gray-500 font-bold">AUTO: <span id="ui-auto">ON</span> VIT: <span id="ui-speed">x2</span></div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="panel-header"><span class="panel-title">JOURNAL DE BORD</span></div>
            <div id="logs" class="log-area"></div>
            <div class="tabs">
                <button class="tab-btn active">AVENTURE</button>
                <button class="tab-btn" onclick="UI.showHub()">BASE</button>
            </div>
        </div>
    </div>

    <div id="hub-view" class="modal-full hidden">
        <h2 class="text-3xl font-bold mb-10">AM√âLIORATION DE LA BASE</h2>
        <div class="grid grid-cols-1 gap-4 w-72">
            <div onclick="Core.upgradeBase('hp')" class="stat-box cursor-pointer hover:border-blue-500"><div class="stat-label">INT√âGRIT√â</div><div class="text-xl font-bold">+20 HP</div><div id="up-hp-cost" class="text-yellow-500">100 ü™ô</div></div>
            <div onclick="Core.upgradeBase('atk')" class="stat-box cursor-pointer hover:border-blue-500"><div class="stat-label">PUISSANCE</div><div class="text-xl font-bold">+5 ATK</div><div id="up-atk-cost" class="text-yellow-500">100 ü™ô</div></div>
            <div onclick="Core.upgradeBase('def')" class="stat-box cursor-pointer hover:border-blue-500"><div class="stat-label">BLINDAGE</div><div class="text-xl font-bold">+2 DEF</div><div id="up-def-cost" class="text-yellow-500">100 ü™ô</div></div>
        </div>
        <button onclick="UI.hideHub()" class="mt-10 text-blue-500 font-bold">RETOUR</button>
    </div>

    <script>
        const DATA = {
            enemies: [{n:"Drone", i:"üõ∏", h:50, a:5}, {n:"Xeno", i:"üëæ", h:70, a:9}],
            items: [
                {n:"Trident", e:"üî±", s:10, t:"weapon", r:"r-common", d:"D√©g√¢ts +10"},
                {n:"Bouclier", e:"üõ°Ô∏è", s:20, t:"head", r:"r-common", d:"PV +20"},
                {n:"Sonde", e:"ü§ñ", s:5, t:"pet", r:"r-common", d:"Stats +5"}
            ],
            rarities: ["r-common", "r-rare", "r-epic", "r-legend"]
        };

        let Player = { char:null, gold:1807, perls:20, stats:{hp:4, atk:26, def:10}, inv:[], eq:{weapon:null, head:null, pet:null}, skills:[] };
        let Run = { active:false, day:0, hp:180, max:180, atk:140, def:20, auto:true, speed:2 };
        let Combat = { active:false, h:0, m:0, a:0 };

        const Core = {
            initGame: () => {
                let save = localStorage.getItem('distory_v52');
                if(save) {
                    Player = JSON.parse(save);
                    if(Player.char) {
                        document.getElementById('boot-screen').classList.add('hidden');
                        document.getElementById('game-ui').classList.remove('blur');
                        UI.refresh();
                    }
                }
            },
            selectSpecies: (emoji) => {
                Player.char = emoji;
                Player.eq.weapon = {...DATA.items[0], uid:Date.now()};
                Core.saveGame();
                document.getElementById('boot-screen').classList.add('hidden');
                document.getElementById('game-ui').classList.remove('blur');
                UI.refresh();
            },
            processScanner: () => {
                if(!Run.active) { Run.active = true; Run.day = 1; UI.log("Mission initialis√©e."); UI.scene('adv'); }
                if(Combat.active) return;
                Run.day++;
                Core.updateStats();
                if(Run.day % 5 === 0) Core.startCombat();
                else { Player.gold += 20; UI.log("> Ressources trouv√©es (+20 Or)"); }
                UI.refresh();
                if(Run.auto) setTimeout(Core.processScanner, 1000/Run.speed);
            },
            startCombat: () => {
                Combat.active = true;
                let en = DATA.enemies[Math.floor(Math.random()*DATA.enemies.length)];
                Combat.m = en.h * (1 + Run.day*0.1); Combat.h = Combat.m; Combat.a = en.a * (1 + Run.day*0.05);
                UI.scene('com');
                document.getElementById('ui-en-img').innerText = en.i;
                setTimeout(Core.combatTurn, 1000/Run.speed);
            },
            combatTurn: () => {
                if(!Combat.active) return;
                Combat.h -= Run.atk;
                if(Combat.h <= 0) { Combat.active = false; UI.log("> Victoire !"); UI.scene('adv'); UI.refresh(); return; }
                Run.hp -= Math.max(1, Combat.a - Run.def);
                UI.refresh();
                if(Run.hp <= 0) { Combat.active = false; Run.active = false; UI.log("> Echec mission."); UI.scene('adv'); }
                else setTimeout(Core.combatTurn, 800/Run.speed);
            },
            updateStats: () => {
                Run.max = 100 + (Player.stats.hp * 20);
                Run.atk = 10 + (Player.stats.atk * 5);
                Run.def = Player.stats.def * 2;
                if(Player.eq.weapon) Run.atk += Player.eq.weapon.s;
                if(Player.eq.head) Run.max += Player.eq.head.s;
                Run.hp = Math.min(Run.hp, Run.max);
            },
            chest: () => {
                if(Player.perls >= 5) {
                    Player.perls -= 5;
                    Player.inv.push({...DATA.items[Math.floor(Math.random()*DATA.items.length)], uid: Date.now()});
                    Core.checkFusion();
                    UI.refresh();
                    Core.saveGame();
                }
            },
            checkFusion: () => {
                let counts = {}; Player.inv.forEach(i => counts[i.n] = (counts[i.n] || 0) + 1);
                for(let n in counts) {
                    if(counts[n] >= 3) {
                        let it = Player.inv.find(x => x.n === n);
                        Player.inv = Player.inv.filter(x => x.n !== n);
                        Player.inv.push({...it, s: it.s * 2, r: "r-rare"});
                        UI.log("> FUSION : " + n); Core.checkFusion(); break;
                    }
                }
            },
            equip: (uid) => {
                let idx = Player.inv.findIndex(x => x.uid === uid);
                let it = Player.inv[idx];
                if(Player.eq[it.t]) Player.inv.push(Player.eq[it.t]);
                Player.eq[it.t] = it;
                Player.inv.splice(idx, 1);
                Core.updateStats(); UI.refresh(); Core.saveGame();
            },
            upgradeBase: (s) => {
                let c = 100 + (Player.stats[s] * 50);
                if(Player.gold >= c) { Player.gold -= c; Player.stats[s]++; Core.updateStats(); UI.refresh(); Core.saveGame(); }
            },
            saveGame: () => localStorage.setItem('distory_v52', JSON.stringify(Player)),
            hardReset: () => { localStorage.clear(); location.reload(); }
        };

        const UI = {
            refresh: () => {
                document.getElementById('ui-gold').innerText = Player.gold;
                document.getElementById('ui-perls').innerText = Player.perls;
                document.getElementById('ui-day').innerText = Run.day;
                document.getElementById('ui-atk').innerText = Run.atk;
                document.getElementById('ui-def').innerText = Run.def;
                document.getElementById('ui-hp-txt').innerText = Math.floor(Run.hp) + "/" + Run.max;
                document.getElementById('ui-hp-fill').style.width = (Run.hp/Run.max*100) + "%";
                document.getElementById('ui-avatar-display').innerText = Player.char;
                
                let g = document.getElementById('inv-grid'); g.innerHTML = '';
                Player.inv.forEach(i => {
                    let d = document.createElement('div'); d.className = "slot " + (i.r||""); d.innerText = i.e;
                    d.onclick = () => Core.equip(i.uid);
                    g.appendChild(d);
                });

                const set = (id, it) => {
                    let el = document.getElementById(id);
                    if(it) { el.innerText = it.e; el.className = "slot glow-active"; }
                    else { el.innerText = ""; el.className = "slot"; }
                };
                set('slot-weapon', Player.eq.weapon);
                set('slot-head', Player.eq.head);
                set('slot-pet', Player.eq.pet);

                document.getElementById('up-hp-cost').innerText = (100 + Player.stats.hp * 50) + " ü™ô";
                document.getElementById('up-atk-cost').innerText = (100 + Player.stats.atk * 50) + " ü™ô";
                document.getElementById('up-def-cost').innerText = (100 + Player.stats.def * 50) + " ü™ô";
            },
            scene: (s) => {
                document.getElementById('enemy-box').classList.toggle('hidden', s !== 'com');
                document.getElementById('story-box').classList.toggle('hidden', s === 'com');
                document.getElementById('main-btn').innerText = (s === 'com') ? "COMBAT" : "RELANCER";
            },
            log: (m) => {
                let l = document.getElementById('logs');
                l.innerHTML = `<div class="log-entry">${m}</div>` + l.innerHTML;
            },
            showHub: () => document.getElementById('hub-view').classList.remove('hidden'),
            hideHub: () => document.getElementById('hub-view').classList.add('hidden')
        };
        window.onload = Core.initGame;
    </script>
</body>
</html>
