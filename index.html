<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distory Go - V44 PRIME</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@600;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { 
            --bg: #030008; --panel: rgba(15, 5, 30, 0.95);
            --border: #6d28d9; --neon: #a855f7; --cyan: #22d3ee;
            --gold: #fbbf24; --danger: #f43f5e;
        }
        body { 
            background: var(--bg); color: #f5f3ff; font-family: 'Rajdhani', sans-serif; 
            overflow: hidden; height: 100vh; user-select: none;
            background-image: radial-gradient(circle at 50% 50%, #1e0a3d 0%, #030008 100%);
        }

        /* NOUVEAU HUD VIOLET */
        .layout { display: grid; grid-template-columns: 350px 1fr 300px; gap: 15px; height: 100vh; padding: 15px; }
        .layout.blur { filter: blur(15px) brightness(0.3); pointer-events: none; }

        .panel { 
            background: var(--panel); border: 1px solid var(--border); border-radius: 4px; 
            display: flex; flex-direction: column; position: relative;
            box-shadow: 0 0 20px rgba(109, 40, 217, 0.2); transition: 0.3s;
        }
        .panel::after { content: ''; position: absolute; inset: 0; border: 1px solid rgba(168, 85, 247, 0.1); pointer-events: none; }

        .head { 
            padding: 10px 15px; background: rgba(109, 40, 217, 0.2); 
            border-bottom: 1px solid var(--border); color: var(--cyan); 
            font-family: 'Share Tech Mono'; font-weight: bold; font-size: 14px;
        }

        /* ZONE CENTRALE */
        .viewport { 
            flex-grow: 1; position: relative; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; overflow: hidden;
            background: radial-gradient(circle, rgba(168, 85, 247, 0.1) 0%, transparent 70%);
        }
        
        /* BOUTON SCANNER (FIX√â) */
        .btn-scanner { 
            width: 100%; height: 80px; background: linear-gradient(to bottom, #a855f7, #6d28d9);
            border: 1px solid #d8b4fe; border-bottom: 5px solid #4c1d95;
            color: white; font-family: 'Share Tech Mono'; font-weight: 900; font-size: 28px;
            letter-spacing: 5px; cursor: pointer; transition: 0.1s; border-radius: 4px;
        }
        .btn-scanner:active { transform: translateY(4px); border-bottom-width: 1px; }
        .btn-scanner:hover { filter: brightness(1.2); box-shadow: 0 0 30px rgba(168, 85, 247, 0.5); }

        /* SLOTS STUFF */
        .slot { 
            width: 100%; height: 60px; background: rgba(0,0,0,0.5); border: 2px solid var(--border); 
            border-radius: 4px; display: flex; align-items: center; justify-content: center; 
            font-size: 30px; cursor: pointer; transition: 0.2s;
        }
        .slot:hover { border-color: var(--cyan); background: rgba(34, 211, 238, 0.1); }
        .rarity-common { border-color: #4b5563; }
        .rarity-rare { border-color: #3b82f6; box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); }
        .rarity-epic { border-color: #d946ef; box-shadow: 0 0 15px rgba(217, 70, 239, 0.4); }
        .rarity-legend { border-color: #fbbf24; animation: pulseLegend 2s infinite; }
        @keyframes pulseLegend { 50% { box-shadow: 0 0 20px #fbbf24; } }

        /* MODALS */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .modal-card { background: #160a2d; border: 2px solid var(--neon); border-radius: 8px; padding: 40px; text-align: center; width: 600px; box-shadow: 0 0 100px rgba(168, 85, 247, 0.3); }

        .hp-bar { width: 100%; height: 10px; background: #000; border-radius: 5px; overflow: hidden; border: 1px solid #4c1d95; }
        .hp-fill { height: 100%; background: linear-gradient(90deg, #701a75, #d946ef); transition: width 0.4s ease; }

        #tooltip { position: fixed; pointer-events: none; z-index: 20000; background: #000; border: 1px solid var(--cyan); padding: 12px; border-radius: 4px; color: white; display: none; box-shadow: 0 10px 20px black; font-size: 14px; }
        
        .log-msg { font-size: 11px; font-family: 'Share Tech Mono'; color: var(--cyan); border-left: 2px solid var(--border); padding-left: 8px; margin-bottom: 4px; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="tooltip"></div>
    <div id="modal-container" class="hidden"></div>
    <div id="toast-layer" class="fixed top-10 left-1/2 -translate-x-1/2 z-[30000] flex flex-col gap-2"></div>

    <div id="boot-screen" class="fixed inset-0 bg-[#030008] z-[50000] flex flex-col items-center justify-center">
        <h1 class="text-8xl font-black text-white mb-4 italic tracking-tighter" style="text-shadow: 0 0 50px #a855f7;">OCTO GO</h1>
        <p class="text-purple-400 font-mono tracking-[10px] uppercase mb-12">Nebula Prime // V44</p>
        <input type="text" id="input-pseudo" class="bg-black border-2 border-purple-600 text-white p-5 w-80 text-center text-xl font-bold rounded mb-6 outline-none focus:border-cyan-400" placeholder="IDENTIFIANT">
        <button onclick="Core.initGame()" class="btn-scanner w-80 !h-20">LANCER</button>
        <button onclick="Core.wipeData()" class="mt-12 text-red-500 uppercase text-xs hover:underline opacity-50">R√©initialisation d'urgence</button>
    </div>

    <div id="game-ui" class="layout blur">
        
        <div class="panel">
            <div class="head">UNIT√â : <span id="ui-pseudo" class="text-white">PILOTE</span></div>
            <div class="hero-zone">
                <div id="ui-hero-img" class="hero-img">üêô</div>
                <div class="absolute top-4 right-4 bg-purple-800 px-3 py-1 rounded text-sm font-bold">NV <span id="ui-lvl">1</span></div>
            </div>
            <div class="p-6 space-y-6">
                <div>
                    <div class="flex justify-between text-xs font-bold text-purple-300 uppercase mb-2">Structure <span id="ui-hp-txt">100/100</span></div>
                    <div class="hp-bar"><div id="ui-hp-fill" class="hp-fill"></div></div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-black/40 border border-purple-900 p-3 text-center">
                        <div class="text-[10px] text-purple-400 font-bold">PUISSANCE</div>
                        <div id="ui-atk" class="text-2xl font-black">10</div>
                    </div>
                    <div class="bg-black/40 border border-purple-900 p-3 text-center">
                        <div class="text-[10px] text-cyan-400 font-bold">BLINDAGE</div>
                        <div id="ui-def" class="text-2xl font-black">0</div>
                    </div>
                </div>
            </div>
            <div class="mt-auto p-4 border-t border-purple-900 bg-black/40 grid grid-cols-3 gap-2">
                <div id="slot-weapon" class="slot rarity-common">‚öîÔ∏è</div>
                <div id="slot-head" class="slot rarity-common">üõ°Ô∏è</div>
                <div id="slot-pet" class="slot rarity-common">üêæ</div>
            </div>
        </div>

        <div class="panel">
            <div class="head flex justify-between">
                <span>SECTEUR EXPLORATION // CYCLE <span id="ui-day" class="text-white">1</span></span>
                <div class="flex gap-4">
                    <span class="text-yellow-400">ü™ô <span id="ui-gold">0</span></span>
                    <span class="text-cyan-400">‚öõÔ∏è <span id="ui-perls">0</span></span>
                </div>
            </div>
            <div class="viewport">
                <div id="enemy-box" class="hidden text-center scale-110">
                    <div class="w-48 h-2 bg-black rounded overflow-hidden mb-4 mx-auto"><div id="ui-en-hp" class="h-full bg-red-600 w-full"></div></div>
                    <div id="ui-en-img" class="text-[160px]">üëæ</div>
                    <div id="ui-en-name" class="text-red-500 font-black text-2xl uppercase mt-4">IDENTIFI√â</div>
                </div>
                <div id="story-box" class="text-center">
                    <div id="ui-story-title" class="text-6xl font-black mb-4 uppercase">Exploration</div>
                    <div id="ui-story-desc" class="text-cyan-400 tracking-[5px] bg-purple-900/20 px-8 py-2 rounded-full border border-purple-500/30">Syst√®mes op√©rationnels</div>
                </div>
            </div>
            <div class="h-56 bg-black border-t border-purple-900 grid grid-cols-12">
                <div class="col-span-8 p-4 overflow-y-auto border-r border-purple-900/50">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-[11px] font-bold text-cyan-400 uppercase tracking-widest">Soute √† mat√©riel</span>
                        <button onclick="Core.fusion()" class="bg-cyan-600 text-black px-3 py-1 rounded text-[10px] font-bold hover:bg-cyan-400">FUSIONNER 3X</button>
                    </div>
                    <div id="inv-grid" class="grid grid-cols-6 gap-2"></div>
                </div>
                <div class="col-span-4 p-4 flex flex-col gap-3">
                    <button id="main-btn" onclick="Core.processScanner()" class="btn-scanner">SCANNER</button>
                    <div class="flex gap-2 h-10">
                        <button onclick="Core.toggleAuto()" id="ui-auto" class="flex-1 bg-black border border-purple-500 text-purple-400 font-bold text-[10px] uppercase rounded">Auto: OFF</button>
                        <button onclick="Core.toggleSpeed()" id="ui-speed" class="flex-1 bg-black border border-purple-500 text-purple-400 font-bold text-[10px] uppercase rounded">Vit: x1</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel">
            <div class="head">SYST√àMES INTERNES</div>
            <div class="p-4 flex-grow overflow-hidden flex flex-col">
                <div class="category-label text-[10px] text-gray-500 font-bold uppercase mb-2">Modules de Combat</div>
                <div id="skill-list" class="flex-grow overflow-y-auto space-y-2"></div>
                <button onclick="UI.showHub()" class="mt-4 w-full py-3 bg-purple-900/30 border border-purple-500 text-cyan-400 font-bold text-xs uppercase hover:bg-purple-800">‚öôÔ∏è Centre d'Am√©lioration</button>
            </div>
            <div id="logs" class="h-40 bg-black/60 border-t border-purple-900 p-3 overflow-y-auto"></div>
        </div>
    </div>

    <div id="hub-view" class="fixed inset-0 bg-black/95 z-[60000] hidden flex-col items-center justify-center p-10">
        <h2 class="text-6xl text-white font-black mb-12 italic border-b-4 border-cyan-500 pb-2 uppercase tracking-tighter">Maintenance Base</h2>
        <div class="grid grid-cols-3 gap-8 w-full max-w-5xl">
            <div onclick="Core.upgradeBase('hp')" class="bg-purple-900/10 border border-purple-500/30 p-8 text-center hover:border-cyan-400 cursor-pointer transition">
                <div class="text-6xl mb-4">‚ù§Ô∏è</div><div class="font-bold text-xl mb-2">√âNERGIE</div>
                <div class="text-orange-400 font-mono font-bold" id="up-hp-cost">100 ü™ô</div>
            </div>
            <div onclick="Core.upgradeBase('atk')" class="bg-purple-900/10 border border-purple-500/30 p-8 text-center hover:border-cyan-400 cursor-pointer transition">
                <div class="text-6xl mb-4">‚öîÔ∏è</div><div class="font-bold text-xl mb-2">FORCE</div>
                <div class="text-orange-400 font-mono font-bold" id="up-atk-cost">100 ü™ô</div>
            </div>
            <div onclick="Core.upgradeBase('def')" class="bg-purple-900/10 border border-purple-500/30 p-8 text-center hover:border-cyan-400 cursor-pointer transition">
                <div class="text-6xl mb-4">üõ°Ô∏è</div><div class="font-bold text-xl mb-2">BLINDAGE</div>
                <div class="text-orange-400 font-mono font-bold" id="up-def-cost">100 ü™ô</div>
            </div>
        </div>
        <button onclick="UI.hideHub()" class="mt-16 text-cyan-400 font-black uppercase tracking-[10px] hover:text-white transition">Fermer Terminal</button>
    </div>

    <script>
        // --- DONNEES ---
        const DATA = {
            chars: ["üêô", "ü¶à", "üê¢", "üëΩ"],
            enemies: [{n:"Drone Pirate", i:"üõ∏", h:50, a:5}, {n:"X√©no", i:"üëæ", h:65, a:8}, {n:"Sonde Fugitive", i:"üõ∞Ô∏è", h:40, a:12}],
            boss: [{n:"KRAKEN VIOLET", i:"ü¶ë", h:800, a:30}, {n:"L√âVIATHAN", i:"üêã", h:1000, a:40}],
            items: [
                {id:"weapon_1", n:"Laser", e:"üî´", s:10, t:"weapon", d:"Augmente la puissance de feu."},
                {id:"head_1", n:"Plaque", e:"üõ°Ô∏è", s:20, t:"head", d:"Renforce la structure."},
                {id:"pet_1", n:"Sonde", e:"ü§ñ", s:5, t:"pet", d:"Module de support IA."}
            ],
            skills: {
                'fire': {n:"Plasma", i:"üî•", d:"D√©g√¢ts de chaleur br√ªlants (+5 ATK/nv)."},
                'heal': {n:"R√©paration", i:"üíâ", d:"Soin nanotechnologique (+5% PV/tour)."},
                'shield': {n:"Bouclier", i:"üõ°Ô∏è", d:"Champ de force tactique (+2 DEF/nv)."}
            }
        };

        // --- ETAT JEU ---
        let Player = { pseudo:"PILOTE", gold:0, perls:20, char:"üêô", stats:{hp:0, atk:0, def:0}, inv:[], eq:{weapon:null, head:null, pet:null}, skills:[] };
        let Run = { active:false, day:0, hp:100, max:100, atk:10, def:0, auto:false, speed:1, state:"READY" };
        let Combat = { active:false, h:0, m:0, a:0 };

        // --- CORE ---
        const Core = {
            initGame: () => {
                let p = document.getElementById('input-pseudo').value.trim();
                if(p) Player.pseudo = p.toUpperCase();
                
                let save = localStorage.getItem('distory_v44');
                if(save) Player = JSON.parse(save);

                document.getElementById('boot-screen').classList.add('hidden');
                document.getElementById('game-ui').classList.remove('blur');
                UI.refresh();
                if(!Player.char) UI.showCharSelect();
            },

            processScanner: () => {
                if(!Run.active) { Core.startRun(); return; }
                if(Combat.active) return;
                Core.nextCycle();
            },

            startRun: () => {
                Run.active = true; Run.day = 1; 
                Run.state = "EXPLORING";
                Core.updateStats();
                Run.hp = Run.max;
                UI.scene('adv');
                UI.log("--- MISSION INITIALIS√âE ---");
                UI.showSkillChoice();
            },

            nextCycle: () => {
                Run.day++;
                Core.updateStats();
                
                // Rythme : Combat tous les 5 ou 10 jours
                if(Run.day % 10 === 0) Core.startCombat(true);
                else if(Run.day % 5 === 0) Core.startCombat(false);
                else {
                    if(Math.random() < 0.3) {
                        UI.showSkillChoice();
                    } else {
                        let gain = 20 + Math.floor(Math.random()*20);
                        Player.gold += gain;
                        UI.msg("Ressources r√©cup√©r√©es : +" + gain + " ü™ô");
                        UI.refresh();
                        Core.checkAuto();
                    }
                }
            },

            startCombat: (isBoss) => {
                Combat.active = true;
                let pool = isBoss ? DATA.boss : DATA.enemies;
                let en = pool[Math.floor(Math.random()*pool.length)];
                let mult = 1 + (Run.day * 0.1);
                
                Combat.m = en.h * mult; Combat.h = Combat.m;
                Combat.a = en.a * mult; Combat.n = en.n;
                
                UI.scene('com');
                document.getElementById('ui-en-img').innerText = en.i;
                document.getElementById('ui-en-name').innerText = isBoss ? "BOSS : " + en.n : en.n;
                UI.refresh();
                setTimeout(Core.combatTurn, 1000/Run.speed);
            },

            combatTurn: () => {
                if(!Combat.active) return;
                // Joueur attaque
                Combat.h -= Run.atk;
                UI.msg("Impact sur cible : -" + Run.atk);
                UI.refresh();

                if(Combat.h <= 0) {
                    setTimeout(Core.endCombat, 500/Run.speed);
                    return;
                }

                // Ennemi attaque
                setTimeout(() => {
                    let dmg = Math.max(1, Combat.a - Run.def);
                    Run.hp -= dmg;
                    UI.msg("Dommages re√ßus : -" + dmg);
                    UI.refresh();

                    if(Run.hp <= 0) {
                        Core.failRun();
                    } else {
                        setTimeout(Core.combatTurn, 800/Run.speed);
                    }
                }, 400/Run.speed);
            },

            endCombat: () => {
                Combat.active = false;
                let gain = 50 + (Run.day * 2);
                Player.gold += gain;
                UI.msg("Cible neutralis√©e. +" + gain + " Cr√©dits.");
                UI.scene('adv');
                UI.refresh();
                Core.saveGame();
                Core.checkAuto();
            },

            failRun: () => {
                Run.active = false; Combat.active = false;
                UI.msg("STRUCTURE D√âTRUITE. RETOUR BASE.");
                UI.scene('adv');
                UI.refresh();
            },

            updateStats: () => {
                Run.max = 100 + (Player.stats.hp * 20);
                Run.atk = 10 + (Player.stats.atk * 5);
                Run.def = 0 + (Player.stats.def * 2);
                
                // Add items
                if(Player.eq.weapon) Run.atk += Player.eq.weapon.s;
                if(Player.eq.head) Run.max += Player.eq.head.s;
                if(Player.eq.pet) Run.atk += Player.eq.pet.s;
                
                // Add skills
                Player.skills.forEach(s => {
                    if(s.id === 'fire') Run.atk += (s.lvl * 5);
                    if(s.id === 'shield') Run.def += (s.lvl * 2);
                });
            },

            fusion: () => {
                let counts = {};
                Player.inv.forEach(i => counts[i.n] = (counts[i.n] || 0) + 1);
                for(let n in counts) {
                    if(counts[n] >= 3) {
                        let it = Player.inv.find(x => x.n === n);
                        Player.inv = Player.inv.filter(x => x.n !== n); // Supprime tous
                        Player.inv.push({...it, s: it.s * 2, n: it.n + "+"}); 
                        UI.msg("FUSION R√âUSSIE : " + n);
                        Core.fusion(); // R√©cursif si possible
                        break;
                    }
                }
                UI.refresh();
                Core.saveGame();
            },

            chest: () => {
                if(Player.perls >= 5) {
                    Player.perls -= 5;
                    let i = DATA.items[Math.floor(Math.random()*DATA.items.length)];
                    Player.inv.push({...i, uid: Date.now()});
                    UI.msg("Nouveau mat√©riel d√©tect√©.");
                    UI.refresh();
                    Core.saveGame();
                } else UI.msg("Mati√®re Noire insuffisante.");
            },

            equip: (uid) => {
                let idx = Player.inv.findIndex(x => x.uid === uid);
                let it = Player.inv[idx];
                let type = it.t;
                if(Player.eq[type]) Player.inv.push(Player.eq[type]);
                Player.eq[type] = it;
                Player.inv.splice(idx, 1);
                Core.updateStats();
                UI.refresh();
                Core.saveGame();
            },

            addSkill: (id) => {
                let existing = Player.skills.find(x => x.id === id);
                if(existing) existing.lvl++;
                else Player.skills.push({id: id, lvl: 1});
                UI.hideModal();
                UI.refresh();
                Core.checkAuto();
            },

            upgradeBase: (stat) => {
                let cost = 100 + (Player.stats[stat] * 50);
                if(Player.gold >= cost) {
                    Player.gold -= cost;
                    Player.stats[stat]++;
                    Core.updateStats();
                    UI.refresh();
                    Core.saveGame();
                }
            },

            toggleAuto: () => { Run.auto = !Run.auto; UI.refresh(); if(Run.auto) Core.checkAuto(); },
            toggleSpeed: () => { Run.speed = (Run.speed === 1) ? 2 : 1; UI.refresh(); },
            checkAuto: () => { if(Run.auto && Run.active && !Combat.active && document.getElementById('modal-container').classList.contains('hidden')) setTimeout(() => Core.processScanner(), 1000/Run.speed); },
            saveGame: () => localStorage.setItem('distory_v44', JSON.stringify(Player)),
            wipeData: () => { if(confirm("Supprimer toute la m√©moire ?")) { localStorage.clear(); location.reload(); } }
        };

        // --- UI ---
        const UI = {
            refresh: () => {
                document.getElementById('ui-pseudo').innerText = Player.pseudo;
                document.getElementById('ui-gold').innerText = Player.gold;
                document.getElementById('ui-perls').innerText = Player.perls;
                document.getElementById('ui-day').innerText = Run.day;
                document.getElementById('ui-lvl').innerText = Math.floor(Run.day/5) + 1;
                document.getElementById('ui-hp-txt').innerText = Math.floor(Run.hp) + "/" + Run.max;
                document.getElementById('ui-hp-fill').style.width = (Run.hp/Run.max*100) + "%";
                document.getElementById('ui-atk').innerText = Run.atk;
                document.getElementById('ui-def').innerText = Run.def;
                
                // Boutons
                document.getElementById('main-btn').innerText = Run.active ? "SCANNER" : "INITIALISER";
                document.getElementById('ui-auto').innerText = "AUTO: " + (Run.auto ? "ON" : "OFF");
                document.getElementById('ui-auto').style.background = Run.auto ? "var(--neon)" : "black";
                document.getElementById('ui-speed').innerText = "VIT: x" + Run.speed;

                // Grilles
                let g = document.getElementById('inv-grid'); g.innerHTML = '';
                Player.inv.forEach(i => {
                    let d = document.createElement('div'); d.className = "slot rarity-common"; d.innerText = i.e;
                    d.onclick = () => Core.equip(i.uid);
                    d.onmouseenter = (e) => UI.tip(e, i.n, i.d + " (Stat +" + i.s + ")");
                    d.onmouseleave = UI.untip;
                    g.appendChild(d);
                });

                const set = (id, it, def) => {
                    let el = document.getElementById(id);
                    if(it) { el.innerText = it.e; el.className = "slot rarity-rare"; el.onmouseenter = (e) => UI.tip(e, it.n, it.d); el.onmouseleave = UI.untip; }
                    else { el.innerText = def; el.className = "slot"; el.onmouseenter = null; }
                };
                set('slot-weapon', Player.eq.weapon, "‚öîÔ∏è");
                set('slot-head', Player.eq.head, "üõ°Ô∏è");
                set('slot-pet', Player.eq.pet, "üêæ");

                let sl = document.getElementById('skill-list'); sl.innerHTML = '';
                Player.skills.forEach(s => {
                    let info = DATA.skills[s.id];
                    sl.innerHTML += `<div class="p-2 bg-white/5 border border-purple-800 rounded flex justify-between items-center cursor-help" onmouseenter="UI.tip(event, '${info.n}', '${info.d}')" onmouseleave="UI.untip()">
                        <span class="text-xl">${info.i}</span><span class="font-bold text-xs">${info.n}</span><span class="text-[10px]">v.${s.lvl}</span>
                    </div>`;
                });

                document.getElementById('up-hp-cost').innerText = (100 + Player.stats.hp * 50) + " ü™ô";
                document.getElementById('up-atk-cost').innerText = (100 + Player.stats.atk * 50) + " ü™ô";
                document.getElementById('up-def-cost').innerText = (100 + Player.stats.def * 50) + " ü™ô";
            },

            scene: (s) => {
                document.getElementById('enemy-box').classList.toggle('hidden', s !== 'com');
                document.getElementById('story-box').classList.toggle('hidden', s === 'com');
            },

            msg: (t) => {
                let l = document.getElementById('logs');
                l.innerHTML = `<div class="log-msg">> ${t}</div>` + l.innerHTML;
            },

            showSkillChoice: () => {
                let keys = Object.keys(DATA.skills);
                let m = document.getElementById('modal-container'); m.classList.remove('hidden');
                m.innerHTML = `<div class="modal-overlay"><div class="modal-card">
                    <h2 class="text-3xl font-black text-cyan-400 mb-8">MISE √Ä JOUR SYST√àME</h2>
                    <div class="grid grid-cols-3 gap-4">
                        ${keys.map(k => `<div onclick="Core.addSkill('${k}')" class="p-4 border border-purple-500 hover:bg-purple-500/20 cursor-pointer rounded">
                            <div class="text-4xl mb-2">${DATA.skills[k].i}</div>
                            <div class="font-bold text-white">${DATA.skills[k].n}</div>
                            <div class="text-[10px] text-gray-400 mt-2">${DATA.skills[k].d}</div>
                        </div>`).join('')}
                    </div>
                </div></div>`;
            },

            showCharSelect: () => {
                let m = document.getElementById('modal-container'); m.classList.remove('hidden');
                m.innerHTML = `<div class="modal-overlay"><div class="modal-card">
                    <h2 class="text-3xl font-black text-white mb-8">S√âLECTION UNIT√â</h2>
                    <div class="flex justify-center gap-6">
                        ${DATA.chars.map(c => `<button onclick="Player.char='${c}';Core.saveGame();UI.hideModal();UI.refresh()" class="text-7xl p-6 bg-purple-900/30 border-2 border-purple-500 rounded-full hover:bg-purple-500 transition">${c}</button>`).join('')}
                    </div>
                </div></div>`;
            },

            modal: (t) => {
                if(t==='settings') {
                    let m = document.getElementById('modal-container'); m.classList.remove('hidden');
                    m.innerHTML = `<div class="modal-overlay"><div class="modal-card">
                        <h2 class="text-2xl font-bold mb-6">PARAM√àTRES</h2>
                        <button onclick="UI.hideModal()" class="w-full py-4 bg-purple-600 rounded font-bold mb-4">REPRENDRE</button>
                        <button onclick="location.reload()" class="w-full py-2 bg-gray-800 rounded text-sm">MENU PRINCIPAL</button>
                    </div></div>`;
                }
            },

            hideModal: () => document.getElementById('modal-container').classList.add('hidden'),
            showHub: () => document.getElementById('hub-view').classList.remove('hidden'),
            hideHub: () => document.getElementById('hub-view').classList.add('hidden'),
            tip: (e, t, d) => { let tt=document.getElementById('tooltip'); tt.innerHTML=`<b>${t}</b><br>${d}`; tt.style.display="block"; tt.style.left=(e.clientX+20)+"px"; tt.style.top=(e.clientY+20)+"px"; },
            untip: () => document.getElementById('tooltip').style.display="none"
        };

        window.onload = () => { UI.refresh(); };
    </script>
</body>
</html>
